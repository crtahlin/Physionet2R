
<!-- Automatically generated by RStudio [12861c30b10411e1afa60800200c9a66] -->
### ImportData_sddb.R
Crt Ahlin --- *May 20, 2013, 1:38 PM*`r opts_chunk$set(tidy=FALSE, comment=NA, fig.path='figure-compile-notebook-12861c30b/')`
```{r}
# data import for ssdb ####

# # set the Sudden Death database directory as working dir
workingDirWindows <- "c:/cygwin/usr/database/sddb/"

# Cygwin compliant path to database 
workingDirCygwin <- "/cygdrive/c/cygwin/usr/database/sddb/"

# load RECORDS list
parseRecords <- paste("cat ",workingDirCygwin, "RECORDS", sep="")
records <- system(parseRecords, intern=TRUE)


# import data  - RR intervals
sddbPatientsRR <- list()
dataframe <- data.frame()
i <- 1
for (rec in records) {
  filename <- paste(workingDirWindows, rec, ".unauditedRR.txt", sep="")
  dataframe <- read.table(filename, sep="\t", dec=".")
  colnames(dataframe) <-
    c("initialTimes","initialAnnotations","intervals",
      "finalAnnotations","finalTimes")
  sddbPatientsRR[[i]] <- dataframe
  names(sddbPatientsRR)[i] <- paste("Zapis", rec)
  i <- i+1
}

# import data - BPM (constructed with ihr)
sddbPatientsHR <- list()
dataframe <- data.frame()
i <- 1
for (rec in records) {
  filename <- paste(workingDirWindows, rec, ".unauditedHR.txt", sep="")
  dataframe <- read.table(filename, sep="\t", dec=".")
  colnames(dataframe) <-
    c("initialTimes","BPM","followsRejected")
  sddbPatientsHR[[i]] <- dataframe
  names(sddbPatientsHR)[i] <- paste("Zapis", rec)
  i <- i+1
}


# import data - const interval BPM (constructed with tach)
sddbPatientsHRconstint <- list()
dataframe <- data.frame()
i <- 1
for (rec in records) {
  filename <- paste(workingDirWindows, rec, ".unauditedHRconstint.txt", sep="")
  dataframe <- read.table(filename, sep="\t", dec=".")
  colnames(dataframe) <-
    c("initialTimes","BPM")
  sddbPatientsHRconstint[[i]] <- dataframe
  names(sddbPatientsHRconstint)[i] <- paste("Zapis", rec)
  i <- i+1
}

# import the annotations
sddbPatientsAnnotations <- list()
dataframe <- data.frame()
i <- 1
for (rec in records) {
  filename <- paste(workingDirWindows, rec, ".annotations.txt", sep=c(""))
  doc <- paste(readLines(filename), collapse="\n")
  doc <- gsub("0\n", "0\tNA\n", doc) # add a tab mark at the end of the line
  doc <- gsub("0$", "0\tNA", doc)
  write(doc, file=paste(filename,"_corrected.txt",  sep=""))
  
  #colnames(dataframe) <-
  #  c("Seconds", "Minutes", "Hours", "Type", "Sub", "Chan", "Num", "Aux")
  dataframe <- read.table(paste(filename,"_corrected.txt",  sep=""),
                          sep="", dec=".", header=TRUE)
  
  sddbPatientsAnnotations[[i]] <- dataframe
  names(sddbPatientsAnnotations)[i] <- paste("Zapis", rec)
  i <- i+1
}

# plot all of the records
i <- 1
for (rec in records){
jpeg(filename=paste("./figures/sddb_RRinterval_", names(sddbPatientsRR[i]), ".jpg", sep=""))
  plot(sddbPatientsRR[[i]]$intervals ~ I(sddbPatientsRR[[i]]$finalTimes/60),
     type="l", ylim=c(0,20), xlim=c(0,1600),
     xlab="Minute od začetka opazovanja",
     ylab="Interval med utripi v sekundah (RR interval)",
     main= names(sddbPatientsRR[i]))
dev.off()
i <- i + 1
}

# how much memory do the objects need?
sort( sapply(ls(),function(x){object.size(get(x))}))

# what levels of annotations exist?
i <- 1
for (rec in records) {
print(levels(sddbPatientsAnnotations[[i]][["Aux"]]))
i <- i+1
}
```
